{% if page.id %}
  {% assign doc_variants = site.pages | where: "id", page.id %}
  {% assign source_files = site.static_files | where_exp: "file", "file.path contains '/Source/'" %}
  {% assign source_files = source_files | where_exp: "file", "file.path contains page.id" %}

  {% assign entry_string = "" %}
  {% if page.version %}
    {% assign entry_string = page.version | join: "," %}
  {% else %}
    {% if page.languages %}
      {% assign entry_string = page.languages | join: "," %}
    {% endif %}
    {% if source_files.size > 0 %}
      {% if entry_string == "" %}
        {% assign entry_string = "source" %}
      {% else %}
        {% assign entry_string = entry_string | append: ",source" %}
      {% endif %}
    {% endif %}
  {% endif %}

  {% assign raw_entries = entry_string | split: "," %}
  {% assign valid_entries = "" %}
  {% assign language_codes = "" %}
  {% assign language_count = 0 %}
  {% assign source_requested = false %}

  {% for code in raw_entries %}
    {% assign code = code | strip %}
    {% if code != "" %}
      {% if code == "source" %}
        {% assign source_requested = true %}
      {% else %}
        {% if language_codes == "" %}
          {% assign language_codes = code %}
        {% else %}
          {% assign language_codes = language_codes | append: "|" | append: code %}
        {% endif %}
        {% assign language_count = language_count | plus: 1 %}
      {% endif %}
    {% endif %}
  {% endfor %}

  {% assign show_switcher = false %}
  {% if language_count > 1 or (source_requested and language_count > 0) %}
    {% assign show_switcher = true %}
  {% elsif source_requested and language_count == 0 %}
    {% assign show_switcher = source_files.size > 0 %}
  {% endif %}

  {% if show_switcher %}
    <nav class="doc-language-switcher" aria-label="Document language and source links">
      {% if language_count > 0 %}
        <div class="doc-language-switcher__group">
          <span class="doc-language-switcher__label">Language:</span>
          {% assign language_entries = language_codes | split: "|" %}
          {% for code in language_entries %}
            {% assign variant = doc_variants | where: "lang", code | first %}
            {% if variant %}
              {% case code %}
                {% when "en" %}
                  {% assign label = "English" %}
                {% when "ja" %}
                  {% assign label = "Japanese" %}
                {% when "vi" %}
                  {% assign label = "Vietnamese" %}
                {% else %}
                  {% assign label = code %}
              {% endcase %}
              {% if variant.url == page.url %}
                <span class="doc-language-switcher__link is-current">{{ label }}</span>
              {% else %}
                <a class="doc-language-switcher__link" href="{{ variant.url | relative_url }}">{{ label }}</a>
              {% endif %}
            {% endif %}
          {% endfor %}
        </div>
      {% endif %}

      {% if source_requested and source_files.size > 0 %}
        <div class="doc-language-switcher__group">
          <span class="doc-language-switcher__label">Source:</span>
          {% for src in source_files %}
            {% assign display_name = src.name | replace: '_source', '' %}
            <a class="doc-language-switcher__link" href="{{ src.path | relative_url }}">{{ display_name }}</a>
          {% endfor %}
        </div>
      {% endif %}
    </nav>
  {% endif %}
{% endif %}
